\chapter{The Artin-Whaples characterization}
\section{Introduction}
\label{sec:orgheadline1}

A striking piece of evidence in favor of the hypothesis that number fields and
function fields are more similar than one might expect is given by
\cite{artinwhaples}, which proves the following theorem:

\begin{thm}[Main theorem of \cite{artinwhaples}]
  \label{thm:maintheorem}
  If a field satisfies the valuation product formula, and if one of those
  valuations is of a suitable type, then it is either a number field or a
  function field.
\end{thm}

We will follow the proof of the theorem, setting out the two axioms and showing
that number fields and function fields satisfy them.

\section{Places and valuations}
\label{sec:orgheadline6}

\subsection{Valuations}
\label{sec:valuations}

A valuation on a field is a way to assign a ``size'' to its elements in a way
that fits our usual expectations of how such functions should behave. For
instance, we have the valuation
\[ |\cdot| : \bc \to \br \]

which is defined by the mapping

\[ |a + ib| \mapsto \sqrt{a^2 + b^2} \]

for $a+ib\in\bc$.

The properties this satisfies (nonnegativity, the triangle inequality, and so
on) are abstracted by the following definition:

\begin{defn}
  Let $k$ be a field. A function $|\cdot|: k\to\br$ is called a
  \textit{valuation} if it satisfies the following properties:\footcite[section
  1]{artinwhaples}
  \begin{enumerate}
  \item $|\alpha| = 0 \iff \alpha = 0$
  \item $\im |\cdot|\subset \rgt$
  \item $|\alpha\beta| = |\alpha||\beta|$
  \item $|\alpha + \beta| \leq |\alpha| + |\beta|$
  \end{enumerate}
\end{defn}

If a valuation satisfies the following, it is called \textit{nonarchimedean}
(and \textit{archimedean} otherwise):

\begin{enumerate}
\item[3'] $|\alpha + \beta| \leq \max(|\alpha|,|\beta|)$
\end{enumerate}

\subsection{Motivation for places}
\label{sec:whatisaplace}
When working with number fields other than $\bq$, we find that there are ``more
primes'' than we might expect. In a naive sense, of course, this is true: for
instance, we have primes like $(1+i)$ in $\bq(i)$.

More generally, we can look at a prime ideal in the ring of integers and
consider the valuation it gives rise to.


For instance, $(3)\subset\zi$ gives us
the valuation

\[ \val x 3 = \val x {(3)} = 3^{-\nu_3(x)} \]

with, e.g. $ \val {36} 3 = 3^{-2} $.

We might then decide to consider the valuations themselves as the fundamental
objects. This is very useful: considering valuations allows us to recover a lot
of data, like the prime ideals of the ring of integers, in a purely
\textit{field-theoretic} way, instead of having to worry about integral closures
and so on.\footnote{I realised the importance of this thanks to \cite{placemse}.}

Of course, this on its own is not very useful, since there are many,
many more possible valuations than there can be ``generalized primes'' (however one
wishes to define that).

\subsection{The equivalence relation on valuations}

The solution is to define a notion of \textit{equivalence} for valuations. One
way to do it is by noticing the following:

\begin{thm}
  Every valuation on a field induces a metric on it.
\end{thm}

A metric defines a metric space structure, and hence a topological space
structure, on the field. We can now say that

\begin{defn}
  Two valuations $\val \cdot 1$ and $\val\cdot2$ are \textit{equivalent} if
  they determine identical topological space structures on the field.
\end{defn}

Another way to do it is as follows: first, notice that raising an absolute value
to any power less than $1$ gives rise to another absolute value. We can, hence,
define two absolute values to be equivalent if there is some power $c\in(0,1)$
for which \[|\cdot|_1 = |\cdot|_2^c\].

These two definitions of \textit{equivalent} are actually equivalent!

\begin{defn}
  An equivalence class of valuations is called a \textit{prime place}, or simply
  a \textit{place} for short.
\end{defn}

The (nontrivial) places of $\bq$ can be classified as follows:

\begin{itemize}
\item the nonarchimedean ones, which correspond to $p$-adic valuations and hence
  to prime ideals $(p)$ in the ring of integers $\bz$ of $\bq$ (and thus to the
  $p$-adic fields arising as completions of $\bq$ under these valuations)
\item the archimedean ones, which correspond to embeddings of $\bq$ into $\br$
  or $\bc$ (``real'' and ``complex'' embeddings)
\end{itemize}

In general, a field may have many archimedean places, corresponding to different
embeddings into $\br$ or $\bc$.

\section{The proof}
\subsection{A finite set of valuations}
\label{sec:orgheadline3}

We now look at a \textit{finite} set of (nontrivial, inequivalent) valuations
$|\cdot|_i$. We have the following\footcite[p. 471--2]{artinwhaples} sequence of
lemmas (the proofs are somewhat ``analytic'' in nature and might be skipped on a
first reading), culminating in a very useful approximation theorem.

\begin{lemma}
  If $|\cdot|_1$ and $|\cdot|_2$ are two inequivalent valuations, there is
  some $\gamma$ such that \[|\gamma|_1 < 1 \text{ and } |\gamma|_2 > 1.\]
\end{lemma}

\begin{proof}
  Equivalent valuations can each be expressed as a power of the other. For
  inequivalence, there must be some $\alpha$ and $\beta$ such that

  \begin{align*}
    \val \alpha 1 &<    1 \leq \val \alpha 2 \\
    \val \beta 1  &\geq 1 >    \val \beta 2
  \end{align*}

  We can then set $\gamma = \alpha/\beta$.
\end{proof}

\begin{lemma}
  If $\val \cdot 1, \val \cdot 2, \ldots, \val \cdot n$ are nontrivial and
  inequivalent, there is some $\alpha$ such that

  \[\val \alpha 1 > 1 \]

  and, for all $i > 1$,

  \[ \val \alpha i < 1.\]
\end{lemma}

This means that we can always find some $\alpha$ that distinguishes a particular
valuation in a set of mutually inequivalent ones.

\begin{proof}
  This is just an extension of the previous lemma, which can be considered to be
  the $n=2$ case of this. We use induction on $n$, assuming we have found some
  $\gamma$ such that

  \begin{align*}
    \val \gamma 1 &> 1\\
    \val \gamma i &< 1, 1 < i \leq n - 1
  \end{align*}

  Now we apply the previous lemma to the set of valuations $\{ \val \cdot 1,
  \val \cdot n \}$ to get a $\delta$ such that $\val \delta 1 > 1$ and $\val
  \delta n < 1$. There are two possible cases:
  \begin{enumerate}
  \item $\val \gamma n \leq 1$. In this case, set $\alpha = \gamma^r \delta$.
    Then

    \[ \val \alpha 1 = \val {\gamma^r} 1 \val \delta 1 > 1 \]

    by construction. In addition, for $r$ sufficiently large,

    \[ \val \alpha i < 1 \]

    for $2\leq i \leq n$, since whatever the valuation of $\delta$ at the other
    primes, the factor of $\val \gamma i ^r$ (which is known to be less than
    $1$, by hypothesis) will eventually outweigh the factor of $\val \delta i$
    for $r$ large enough.

  \item If $\val \gamma n > 1$, set

    \[ \alpha = \frac{\gamma^r}{\gamma^r + 1} \delta \]

    so that we have

    \[ \val \alpha i = \frac{\val \gamma i ^r \val \delta i}{\val {\gamma^r + 1}
        i} \leq \frac {\val \gamma i ^r} {1 - \val \gamma i ^r} \val \delta i
    \]

    for $2 \leq i \leq n - 1$, and

    \[
      \val \alpha n \leq \frac{\val \gamma n ^r} {\val \gamma n ^r - 1} \val
      \delta n.
    \]

    For $r$ large enough, $\val \alpha i < 1$ (since the numerator goes to $0$
    as $r\to\infty$) for $2\leq i\leq n-1$.

    Note that

    \[ \lim_{r\to\infty} \frac{\val \gamma n ^r} {\val \gamma n ^r - 1} = 1 \]

    (since $\val \gamma n > 1$) so $\val \alpha n < 1$ since $\val \delta n < 1$
    by hypothesis. Hence this satisfies the conditions of the theorem for $2\leq
    i \leq n$.

    For the case $i = 1$, observe that

    \[ \val \alpha 1 \geq \frac {\val \gamma 1 ^r} {1 + \val \gamma 1 ^r} \val
      \delta 1 \]

    so choosing a sufficiently large $r$ gives us $\val \alpha 1 > 1$.

  \end{enumerate}
\end{proof}

\begin{lemma}
  If $|\cdot|_i$ are inequivalent, for every $\epsilon>0$, there is an $\alpha$
  such that

  \[ \val {\alpha - 1} 1 \leq \epsilon \]

  and

  \[ \val \alpha i \leq \epsilon \text{ for }i>1. \]

\end{lemma}

\begin{proof}
  Choose an appropriate $\gamma$ according to the previous lemma, so that $\val
  \gamma 1 > 1$ and $\val \gamma i < 1$ for $i > 1$. Set

  \[ \alpha = \frac {\gamma^r} {1 + \gamma^r} \]

  Then

  \[ \val {\alpha - 1} 1 = \frac 1 {\val {1 + \gamma^r} 1} \leq \frac 1 {\val
      \gamma 1 ^r}\footnote{The $\val \cdot 1$ in the denominator is just a
      $|\cdot|$ in the original paper, which I suspect is a typo since $|\cdot|$
      hasn't been defined to mean anything at this point.} \leq \epsilon \]

  for $r$ sufficiently large, while, for $i>1$, we have

  \[ \val \alpha i = \frac {\val \gamma i ^r} {\val {1 + \gamma^r} i} \leq \frac
    {\val \gamma i ^r} {1 - \val \gamma i ^r} \leq \epsilon \]

  (again, for $r$ sufficiently large).

\end{proof}

\begin{thm}[Approximation theorem]
  \label{eq:approximation}

  Given pairs $(|\cdot|_i, \alpha_i)$, with the $|\cdot|_i$ inequivalent,
  then for every $\epsilon>0$ there is some $\alpha$ with
  \[|\alpha - \alpha_i|_i < \epsilon.\]
\end{thm}

\begin{proof}
  Let

  \[ M = \max \{ \val {\alpha_i} j : 1\leq i, j\leq n \} \]

  and choose $\gamma_i$ such that

  \[ \val {1-\gamma_i} i < \frac\epsilon {nM}\]

  and

  \[\val {\gamma_i} j < \frac\epsilon{nM} \text { for } i\neq j. \]

  Now set

  \[ \alpha = \sum_i \alpha_i\gamma_i. \]

  Then we have $\val {\alpha-\alpha_i} i < \epsilon$ for all $i$. To see this,
  assume without loss of generality that $i = 1$. Then

  \[ \alpha - \alpha_1 = \alpha_1(\gamma_1 - 1) + \sum_{i>1}\alpha_i\gamma_i \]

  and, applying $\val \cdot 1$, we get

  \begin{align*}
    \val {\alpha-\alpha_1} 1 &\leq \val {\alpha_1} 1\val {\gamma_1 - 1} 1 + \left|{\sum_{i>1}\alpha_i\gamma_i}\right|_1\\
                             &\leq \val {\alpha_1} 1\val {\gamma_1 - 1} 1 + \sum_{i>1}\val {\alpha_i} i\val{\gamma_i}i \\
                             &\leq \frac \epsilon {nM} \sum_i \val {\alpha_i} 1 \\
                             &\leq \epsilon.
  \end{align*}

  by the definition of $\rmm$.
\end{proof}

\begin{cor}
  \label{eq:corollary}
  If $|\cdot|_i$ are nontrivial and inequivalent, then any identity of the
  form \[ P(\alpha) := \prod |\alpha|_{i}^{\nu_i} = 1\] with $0\neq \alpha\in k$ implies
  that the $\nu_i$ are all $0$.
\end{cor}

\begin{proof}
  The argument follows quite naturally from our lemmas, which tell us that we can
  find elements of $k$ with precisely determined valuations at a given set of
  primes.

  Let $\nu_i\neq 0$. Choosing an $x$ for which $\val x i$ is sufficiently large
  and the other $\val x j$ for $i\neq j$ are sufficiently close to $1$ gives us
  the necessary contradiction in the form of an $\alpha$ such that $P(\alpha) >
  1$.
\end{proof}

Theorem \ref{eq:corollary} ``precludes the possibility that a finite number of
valuations can ever be interrelated''. Nevertheless, an infinite number of
valuations \textit{can} be interrelated in such a way -- and this, claims
\cite{artinwhaples}, characterizes number fields and function fields.

\section{The product formula}
\label{sec:productformula}

We now come to the product formula referred to in \ref{thm:maintheorem}. Recall
that it states that a field satisfying two particular axioms with respect to the
valuations defined on it must either be a number field or a function field.

We will now look at the two axioms of the theorem.

\subsection{Axiom 1: the valuation product formula}
\label{sub:axiom1}
\begin{axiom}
  \label{eq:axiom1}
  There is a set $\rmm$ of pairs $(\pp, |\cdot|_\pp: k\to\br_{>0})$ such that, for any $0\neq
  \alpha \in k$,
  \begin{itemize}
  \item $\val\alpha\pp = 1$ for almost all $\pp$
  \item Extending the product over all primes,
    \[ \prod_\pp \val\alpha\pp = 1 \]
  \end{itemize}
  For instance, for $6\in\bq$, the product looks like
  \[ \val6{(0)} \cdot\val6{(2)}\cdot\val6{(3)} = 6\cdot 2^{-1} \cdot 3^{-1} =
    1 \]
\end{axiom}
Notice that, since $\val{1+1}{(\pp)} > 1$ for archimedean $\pp$, $\rmm$ can only
contain finitely many archimedean places.

We have mentioned earlier that to any prime $\pp$, we can associate infinitely
many equivalent valuations on $k$. This axiom allows us to choose one particular
valuation as a distinguished representative of its equivalence class.

\subsection{Id\`eles}
\label{sec:orgheadline19}
Consider a set $\rmm$ defined as above. We define a vector space $V_M$, whose
elements are vectors of the form

\[ v={ (v_\pp) }_\pp, \text{where } v_\pp \in k_\pp. \]

We will simplify notation by writing $\val v\pp$ for $\val{v_\pp}\pp$.

\begin{defn}
  A vector $(v_\pp)$ of this form is an \textit{id\`ele} if
  \begin{itemize}
  \item $v_\pp\neq 0$ for all $\pp$
  \item $v_\pp = 1$ for almost all $\pp$
  \end{itemize}
\end{defn}

There is a natural embedding $k\hookrightarrow V_M$, which may very well be
called a ``diagonal embedding'' (similarly to how $\bq$ has a natural inclusion
into $\adq$). Writing $i_\pp$ for the inclusion $k\to k_\pp$, this embedding
is given by

\[\alpha\mapsto{ (i_\pp(\alpha)) }_\pp\]

\subsection{The volume of an id\`ele}
\label{sec:orgheadline12}

For each id\`ele $\fA$, define
\[V(\fA) = \prod_\pp \val\fA\pp \]

This function is obviously multiplicative, the product of the two (possibly) infinite
products being well-defined since an id\`ele has valuation $1$ at almost every
place. In this sense, id\`eles can be considered ``measurable'' elements of $V_M$.

\begin{enumerate}
\item For elements $\alpha$ coming from $k$ via the embedding, notice that we have, via
  the product formula \ref{sec:productformula},

  \[V(\alpha) = \prod_\pp \val\fA\pp = 1.\]

  This gives \[V(\alpha\fA) = V(\alpha)V(\fA) = V(\fA). \]

\item A map $\pp\mapsto x_\pp \in\br$, with $x_\pp = 1$ for almost all
  $\pp$, gives a set of vectors with the $\pp$-component given by all $\fC$
  such that

  \[\val \fC\pp \leq x_\pp\]

  which we call the parallelotope with dimensions $x_\pp$ or even simply $x$. In this
  case, the number $V(\fA)$ can be thought of as the ``volume'' of the
  parallelotope defined by the coordinates of $x$.

  It is later shown that all valuations are either archimedean or discrete (in
  the sense defined in \ref{sec:whatisaplace}). If this is true, then for any
  collection of elements $x_\pp \in \br$, among all the elements of $k_\pp$,
  some $\alpha_\pp \in k_\pp$ will have the largest valuation not greater than
  $x_\pp$.

  Hence, we can, without loss of generality, replace our map $x$ with
  an id\`ele $\fA$ and construct all vectors $\fC$ satisfying

  \[ \val \fC \pp \leq \val \fA \pp \]

  instead.

\end{enumerate}

\section{Other notions}
\subsection{The order of a set}
\label{sec:order}

\cite{artinwhaples} defines a notion of \textit{order}, stating that it

\begin{quotation}
  [unites] different types of fields\footcite[p. 474]{artinwhaples}
\end{quotation}

although the definition itself is a a construction I have little motivation for.
The purpose of this is mainly to enable the definition of a notion of ``size''
for the set of elements $\alpha \in k$ that are contained in a given
$\fA$-parallelotope (where we are transparently considering elements of $k$ as
elements of $V_M$ using the diagonal embedding), which gives us some information
about $\fA$.

\begin{defn}
  Given a ``field of discourse'' $k$, the order $O(S)$ of a set $S$ of elements
  is defined as follows:
  \begin{enumerate}
  \item If $k$ has an archimedean valuation, then the order of a set is its the
    number of elements.
  \item If all the valuations of $k$ are nonarchimedean, there is some field of
    constants $k_0 \subset k$. (For instance, if $k = \bff_q(\sqrt t)$, $k_0 =
    \bff_q$.) The order of a set is then defined to be $q^s$, where we define
    $q$ and $s$ as follows:
    \begin{enumerate}
    \item If $k_0$ is finite, $q$ is its number of elements. Otherwise, $q$ is
      an arbitrary fixed number greater than $1$.
    \item $s$ is the number of elements in the set that are linearly independent
      over $k_0$.
    \end{enumerate}
  \end{enumerate}
\end{defn}

\begin{example}[A special case]
  Consider the situation of a finite field $k_0$ of constants, and a
  $k_0$-vector space $S$ (or, according to the original,
  \begin{quotation}
    should [...] our set be closed under addition and under multiplication by
    elements of $k_0$\footcite[p. 474]{artinwhaples}
  \end{quotation}
  which implies a \textit{finite-dimensional} vector space structure). Then, by
  the definition of the order for a finite base field, and noting that there
  exists a finite basis

  \[ B = \{b_1, \ldots, b_s \}\]

  by assumption (where $s = \dim_{k_0}S$), we find that $O(S) = q^s$ is just
  the number of elements in $S$.

\end{example}
\subsection{The $\rmm$-function}
\label{subsec:mfunction}
The order of a set of elements contained in the parallelotope of size $\fA$ will
be denoted $\rmm(\fA)$.

Note that, for nonzero $\theta\in k$, $\rmm(\theta\fA)=M(\fA)$. This is because
multiplying by $\theta$ changes the parallelotope of size $\fA$ into the
parallelotope of size $\theta\fA$. This does not change the order (this can be
seen by looking at the cases in the definition of order, noting that linear
(in)dependence is not affected if all elements of a subset of a vector space are
multiplied by a field element).

\subsection{The ring of $\pp$-integers, and the norm}
\label{subsec:ring-of-integers}
The set of elements $\alpha\in k$ for which $\val\alpha\pp \leq 1$ forms a
ring, which we denote $\op$ (the \textit{ring of $\pp$-integers}).

\begin{example}
  In the case of, say, $k = \bq$, the ring of $(2)$-integers is, as one might
  expect, $\bz_2$ (and so on).
\end{example}

The subset of $\op$ with $\val\alpha\pp < 1$ forms an ideal in this ring, which,
by abuse of notation, is also denoted $\pp$ (or $\pp\op$). Now we have a
quotient field $\op/\pp$, and so on. The \emph{order} of this field, if finite,
is called the norm $\Nm\pp$ of $\pp$.

For instance, if there is a constant field $k_0 \subseteq k^{\pp} := \op/\pp$, we
have

\[ \Nm\pp = O(k^\pp) = q^f \]

where we put $f = {[k^\pp : k_0]}$ and $q$ is the order of $k_0$, as before.

\section{Axiom 2}
\label{sub:axiom2}
\begin{axiom}
  \label{eq:axiom2}
  The set $\rmm$ of \ref{eq:axiom1} contains at least one prime $\qq$, which is of
  one of the following types:
  \begin{itemize}
  \item discrete, with a quotient field of finite order $\Nm\qq$
  \item archimedean, with $k_\qq=\br$ or $\bc$
  \end{itemize}
\end{axiom}
Note that, by Ostrowski's theorem, the second part of the condition on
archimedean places is superfluous.

\subsection{Another valuation}
\label{sec:orgheadline21}
For $\alpha\neq 0$, define a valuation as follows:
\begin{itemize}
\item For $\pp \not | \infty$ set
  \[ { \left\lVert \alpha \right\rVert }_\pp = { \Nm\pp^{-\nu} } \]
  where $\nu = \val \alpha \pp$. This covers the case of function fields, since
  all valuations are nonarchimedean in that case.
\item If $k=\br$, $\left\lVert \cdot \right\rVert_\pp$ is defined to be the
  standard absolute value.
\item If $k=\bc$, $\left\lVert \cdot \right\rVert_\pp$ is set to be the square
  of the usual absolute value on $\bc$. (This is not a valuation in the usual
  sense!)
\end{itemize}
This is called the \textit{normed valuation at $\pp$}.

Note that in the case of $p\in\bz$ prime, the normed valuation corresponding to
$(p)\in\spec\bz$ is the usual $p$-adic valuation

\[ \val x p = p^{-\nu_p(x)}. \]

\section{Number fields and function fields work}
We next come to the following theorem, which tells us that number fields and
function fields satisfy the two axioms stated above:

\begin{thm}
  \label{thm:works}
  We can construct $\rmm$ such that both \ref{eq:axiom1} and \ref{eq:axiom2} hold
  for the following fields:
  \begin{itemize}
  \item a number field, i.e., a finite extension $K/\bq$
  \item a field of algebraic functions over any field $k_1$ (that is, a finite
    extension $K/k_1(z)$ with $z$ transcendental over $k_1$)
  \end{itemize}
  In the second case, the field of constants $k_0 \subset k$ consists of all
  elements of $k$ algebraic over $k_1$.
\end{thm}

The proof of this is done through a sequence of lemmas.

\begin{lemma}[\ref{eq:axiom1} transfers to subfields]
  Let $k$ be a field for which \ref{eq:axiom1} holds, and $F$ a subfield that
  does not exclusively comprise constants of $k$. Let $\rn$ be the set of
  nontrivial divisors $p$ of $F$ that are divisible by some $\pp$ of $\rmm$.
  Then \ref{eq:axiom1} holds in $F$ for $\rn$.
\end{lemma}

\begin{proof}
  Let $p \in\rn$, and $a\in F$ with $\val a p > 1$. Then $\val a \pp > 1$ for all
  $\pp|p$ (as can be seen by writing $p = \pp p'$).

  Because of \ref{eq:axiom1}, there can only be a finite number of such
  $\pp|p$. We now define valuations

  \[ \val \alpha p = \prod_{\pp|p} \val \alpha \pp \]

  for $\alpha\in F$, noting that the products are finite and hence well-defined.
  The set of all such $\val \cdot p$ satisfies \ref{eq:axiom1}.
\end{proof}

\begin{lemma}[\ref{eq:axiom1} transfers to finite algebraic extensions]
  Let $k$ be a field for which \ref{eq:axiom1} holds and $K/k$ a finite algebraic
  extension. Let $\rn$ be the set of all divisors $\fN$ of $K$ that divide some
  $\fM$ of $\rmm$. Then \ref{eq:axiom1} holds in $K$ for some subset $\rn' \subset \rn$.
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

In fact, $\rn' = \rn$, but we do not demonstrate this here since it is not
required for the proof (the existence of any set of places satisfying our
criteria is sufficient).

\subsection{The product formula exists for $\bq$ and $k(z)$}

We now look at the special case of $K = k_1(z)$. The proof involves some
interesting interaction between ring-theoretic ideals and valuation theory.

\begin{thm}
  \label{thm:ffworks}
  A product formula of the type referred to in \ref{eq:axiom1} exists for
  $K=k_1(z)$.
\end{thm}

\begin{proof}
  Consider a nontrivial valuation $p$ of $K$ that is trivial on $k_1$. $p$ is
  nonarchimedean, and there are two possible cases (by Ostrowski's
  theorem\footcite{kcnrdostrowskift}):

  \begin{enumerate}
  \item $\val z p \leq 1$. This implies that $\val {f(z)} p \leq 1$ for all
    polynomials in $z$, as can be seen by writing (omitting the $p$ subscript to
    simplify the notation):

    \begin{align*}
      \val {f(z)} &=    \vval {a_nz^n + a_{n-1}z^{n-1} \cdots + a_0} \\
                  &\leq \max{\left( \vval {a_n} \vval z ^n, \vval {a_{n-1}}\vval z^{n-1}, \ldots, \vval {a_0} \right)} \\
                  &\leq \max{\left( \vval z ^n, \vval z^{n-1}, \ldots, 1 \right)} \\
                  &\leq 1.
    \end{align*}

    Here we use the triviality of $\val \cdot p$ when restricted to $k_1$, and
    the nonarchimedeanness of the valuation, to bound the valuation above.

    Now let $p(z)$ be a polynomial of the minimal possible
    degree such that $\val {p(z)} p < 1$ holds. If $g(z)$ is another such
    polynomial, we use the division algorithm in $k_1(z)$ to get

    \[ g(z) = p(z)h(z) + r(z) \]

    where $\deg r(z) < \deg p(z)$. Rewriting the above relation as

    \[ r(z) = g(z) - p(z)h(z) \]

    gives us $\val {r(z)} p < 1$, which implies $r(z) = 0$.

    Now let $\phi \in K$ be some polynomial in $z$ and write

    \[ \phi(z) = \varphi(z) \cdot p(z)^\nu \]

    where $\varphi$ contains no factors of $p(z)$ in the numerator or denominator
    (which means that $\nu = \val \phi p$, so the $p(z)^\nu$ factor ``captures''
    the $p(z)$-term).

    To find the normed valuation ${ \left\lVert \cdot \right\rVert }_p$ in this case,
    we have to determine the degree of the quotient field $L := k_1(z)/p(z)$ over
    the base field $K$. We know that

    \[ [L:K] = f := \deg p(z) \]

    so that we have $\Nm p = q^f$ and

    \[ {\left\lVert \phi(z) \right\rVert}_p = q^{-\nu f}. \]

  \item If $\val z p > 1$ then we replace $z$ by $y := 1/z$.

    Then $\val y p < 1$
    and this reduces to our previous case. Now, the lowest-degree polynomial in
    $y$ is just $y$, so there is only one such prime divisor $p$ of this kind.
    We will denote it $p_\infty$.

    Let $\phi(z) = g(z)/h(z)$, and set $m := \deg g(z), n := \deg h(z)$. We then
    have

    \[ \phi(z) = y^{n-m} \frac {g_1(y)} {h_1(y)} \]

    where neither $g_1$ nor $h_1$ are divisible by $y$. Then

    \[ \nval {\phi(z)} {p_\infty} = q^{m - n}. \]
  \end{enumerate}

  We can construct a product formula connecting this set of valuations, or a
  subset, in the form

  \[ \prod_p \nval {\phi(z)} p^{\lambda(p)} = 1 \]

  where the $\lambda(p)$ are nonnegative constants.

  Now we substitute $\phi(z) = p(z)$ with $p(z)$ irreducible. There can only be
  two possible factors in the product formula that are not equal to $1$: the one
  corresponding to $p$ itself, and the $p_\infty$ factor at infinity. Writing
  out the expression (omitting the factors of $1$ corresponding to all the other
  primes), we have

  \[ q^{f\lambda(p)} q^{-f\lambda(p_\infty)} = 1 \]

  so $\lambda(p) = \lambda(p_\infty)$. Since the choice of $p$ was arbitrary, we
  conclude that

  \[ \lambda(p_1) = \lambda(p_2) = \cdots = \lambda(p_\infty) \]

  and we may as well set them all equal to $1$. Now we define a volume function
  $V$ as before on the id\`eles of $k_1(z)$:

  \[ V(\phi(z)) = \prod_p \nval {\phi(z)} p \]

  This is obviously multiplicative and satisfies $V(1/f) = 1/V(f)$.

  The multiplicativity of the $V$-function, together with the observation that
  $V(p(z)) = 1$ for all irreducible $p(z)$, allows us to conclude the result

  \[ V(\phi(z)) = 1 \]

  for all nonzero $\phi(z)\in k_1(z)$.

\end{proof}

We now treat the case of $\bq$, which is analogous.

\begin{thm}
  A product formula of the type referred to in \ref{eq:axiom1} exists for $\bq$.
\end{thm}

\begin{proof}
  From Ostrowski's theorem, any valuation on $\bq$ is either

  \begin{enumerate}
  \item the standard absolute value $\vval\cdot = \nval\cdot {p_\infty}$,
    corresponding to the ``prime at infinity'' $p_\infty$, or
  \item one of the ordinary $p$-adic valuations $\val\cdot p$ on $\bq$, given by

    \[ \val a p = p^{-\nu} \]

    where $\nu := \nu_p(a)$ is the $p$-valuation of $a$, i.e. the exponent of $p$ in
    the expression

    \[ a = p^\nu \cdot \frac st \text{ where } p\nmid s, t. \]
  \end{enumerate}

  We again consider a hypothetical product formula

  \[ \prod_p \nval a p^{\lambda(p)} = 1 \]

  as before, and substitute an irreducible $p \in\bz$ (which is just a prime).
  This gives us

  \[ p^{-\lambda(p)} \cdot p^{\lambda(p_\infty)} = 1 \]

  and we again have $\lambda(p) = \lambda(p_\infty)$. Again, since we chose $p$
  arbitrarily, this holds for all primes $p$ and we get

  \[ \lambda(p_1) = \lambda(p_2) = \cdots = \lambda(p_\infty) \]

  where we can again assume $\lambda(p_i) = 1$ for all $i$. We construct a
  volume function in exactly the same way as before to complete the proof of the
  product formula for $\bq$.

\end{proof}

Having proven the theorem for the cases $K=\bq$ and $K=k_1(z)$ is sufficient for
us to conclude the main result, since we can transport our proofs to arbitrary
finite algebraic extensions of these base fields using the lemmas demonstrated
previously.

\subsection{Putting it all together}

\begin{thm}
  \ref{eq:axiom1} holds in the case of $\bq$ and that of $K=k_1(z)$ for $k_1$ an
  arbitrary field.
\end{thm}

The set $\rmm$ of valuations is the set of all valuations in the case of
$\bq$, and the set of valuations trivial on $k_1$ in the latter case. The
product formula is of the form

\[ \prod_p {\left\lVert a \right\rVert}_p = 1 \]

or a power, and there is no other relation between these valuations.

From the last two lemmas, we see that \ref{eq:axiom1} holds for the fields of
theorem \ref{thm:maintheorem}. The fact that all valuations of $\rmm$ satisfy
\ref{eq:axiom2} follows from the fact that this is true in $\bq$ and hence in a
finite extension $k/\bq$.

It remains to prove the statement about the field $k_0$ of constants in case $2$
of \ref{thm:works}.

\begin{proof}
  Assume that $p$ is trivial on $k_1$. Then it will also be trivial on any
  algebraic extension of $k_1$.

  Hence we need only show that any element $a \in k_0$ is algebraic with respect
  to $k_1$. If $a$ were transcendental with respect to $k_1$, then from the
  minimal polynomial of $a$ over $k_1(z)$, we find that $z$ would have to be
  algebraic with respect to $k_1(a)$.

  Since $k_1(c)$ is in $k_0$, this would mean that $z$ is in $k_0$. This would
  imply that $k\subseteq k_0$, and $p$ would be trivial on all of $k$ -- which
  is a contradiction.
\end{proof}



\section{Characterizing fields by the product formula}

In this section, $k$ is an arbitrary field with a set of valuations $\rmm$
satisfying axioms \ref{eq:axiom1} and \ref{eq:axiom2}. We will prove that it is
of one of the two types mentioned before.

\subsection{Definitions}

Consider a prime $\pp$ satisfying Axiom 2. We will need to distinguish $\val
\alpha \pp$ and $\nval \alpha \pp$ (the normed valuation corresponding to
$\pp$).

We define $\rho(\pp) > 0$, $\rho(\pp) \in \br$ by writing

\[ \val \alpha \pp = \nval \alpha \pp ^{\rho(\pp)} \]

Let $K$\footnote{The $R$ that the original uses is slightly confusing.} refer to
the following subfield of $k$:

\begin{enumerate}
\item If $\rmm$ has archimedean valuations, then $K := \bq$. In this case we set
  \[ \nval a \pin = |a|, \]
  the ordinary absolute value on $\br$.

\item In the other case, as we have seen before, $k$ has a field of constants
  $\koo$. It cannot contain any algebraic extension of $\koo$ since any
  valuation trivial on $\koo$ would also be trivial on that extension.

  Let $z$ be any element of $k$ not in $\koo$. Then $K = \koz$ is a
  transcendental extension of $\koo$. We will refer to elements of $\koo[z]$ as
  the ``integers'' of $\koz$.

  $\inval a$, in this case, will refer to the particular valuation found during
  the proof of \ref{thm:ffworks} which has $\inval z > 1$.
\end{enumerate}

In both cases, $\ppn$ is some divisor in $\rmm$ that divides $\pin$. Since the
product formula, when applied to elements of $K$, reduces to the formula of the
main theorem (TODO LINK), there must be at least one such $\ppn$ (since all
other valuations are less than $1$ for $\alpha\in K$, but the product must be
equal to $1$). The other primes are called \textit{finite}.

For elements $a\in K$, the valuations $\ival\cdot$ and $\inval\cdot$ are
equivalent. We define $\lambda(\ppn) > 0$ by

\[ \val a \ppn = \nval a p ^{\lambda(\ppn)} \]

The idea behind the proof is to show that $k$ is a finite extension of $K$.

\subsection{The proof}

\begin{lemma}
  \label{thm:thetaexists}
  Let
  \begin{itemize}
  \item $\qq$ be a prime satisfying \ref{eq:axiom2}
  \item $\rs$ be a set of elements of $k$, with order $M>1$
  \item $x$ be an upper bound on $\qq$-valuations for elements of $\rs$, that is,
    \[ \val\alpha\qq \leq x \text{ for all } \alpha\in\rs \]
  \end{itemize}
  Then there exists an element $\theta\in k$ with the following properties:
  \begin{itemize}
  \item $\theta\neq 0$
  \item $\theta$ is either a difference of two elements of $\rs$, or, if there
    is a field of constants $\koo$, a $\koo$-linear combination of elements of $\rs$
  \item For some constant $A_\qq$ (depending only on $\qq$),
    \[ \val\theta\qq \leq A_\qq \cdot \frac x{M^{\rho(\qq)}} \]
  \end{itemize}
\end{lemma}

\begin{proof}
  Omitted.
  % There are three cases to consider.
  % \begin{itemize}
  % \item $\qq$ archimedean, $k_\qq$ real. We can embed $k$ into $\br$ in this
  %   case. We have

  %   \[ \nval \alpha \qq \leq x^{1/\rho(\qq)} \]

  % \end{itemize}
\end{proof}

\begin{lemma}
  Let $M$ be the order of the set of elements $\alpha\in k$ contained in a
  parallelotope of dimensions $x_\pp$. If $\qq$ is a prime satisfying
  \ref{eq:axiom2}, we can find some $B_\qq$ depending on $\qq$ such that either
  $M = 1$ (which happens if the set only contains $\alpha=0$), or

  \[ M \leq B_\qq  {\left( \prod_\pp x_\pp \right)} ^{1/\rho(\qq)} \]
\end{lemma}

\begin{proof}
  Assume $M>1$. Note that the $\qq$-component of the id\`ele $x$ is an upper
  bound on $\qq$-valuations, so by \ref{thm:thetaexists}, there is a $\theta\neq
  0$ satisfying

  \[ \val\theta\qq \leq A_\qq \cdot \frac {x_\pp}{M^{\rho(\qq)}} \]

  For the other $\pp\in\rmm$ we estimate $\theta$ to get

  \[
    \val\theta\pp \leq
    \begin{cases}
      x_\pp, &\pp \text{ nonarchimedean}\\
      4^{\rho_(\pp)}\cdot x_\pp, &\pp \text{ archimedean}
    \end{cases}
  \]

  Substituting into the product formula, we get

  \[ 1\leq \frac{D_\qq \prod_\pp x_\pp}{M^{\rho(\qq)}} \]

  and rearranging gives

  \[ M \leq { D_\qq^{1/\rho(\qq)} } \cdot {\left( \prod_\pp x_\pp \right)}^{1/\rho(\qq)} \]

  and we are done.

\end{proof}

\begin{lemma}
  If $\alpha_1,\alpha_2,\ldots,\alpha_l\in k$ are linearly independent over $K$,
  and if $y$ is some nonzero integer of $K$, we can construct a certain set $\rs$
  of elements $\alpha$ such that

  \begin{itemize}
  \item $\val\alpha\pp\leq a_\pp = \max\left( \val{\alpha_1}\pp,\val{\alpha_2}\pp,\ldots,\val{\alpha_l}\pp\right)$
  \item $\val\alpha\ppn \leq B\cdot\val y\ppn$ for a certain constant $B$.
  \item If there is a field of constants $\koo$, then $\rs$ is a $\koo$-vector space.
  \item The order of $\rs$ satisfies
    \[ O({\rs}) > \inval y ^l \]
  \end{itemize}
\end{lemma}
\begin{proof}
  Omitted.
\end{proof}

\begin{lemma}
  The degree $n := [k:K]$ is finite; every $\pp$ of $M$ satisfies
  \ref{eq:axiom2}, and we have

  \[ n \leq \frac1{\rho(\pp)} \cdot \sum_{\ppn}\lambda(\ppn) \]

  for all $\pp$\footnote{The original writes $p$ here.}.
\end{lemma}
\begin{proof}
  Omitted.
\end{proof}

With this, we have completed the proof of the following result:

\begin{thm}
  If $k$ is a field that satisfies \ref{eq:axiom1} and \ref{eq:axiom2}, it is an
  extension of either
  \begin{itemize}
  \item $K = \bq$, the field of rational numbers, or
  \item $K = \koz$, the field of rational functions in one variable $z$ over the
    field of constants $\koo$ of $k$
  \end{itemize}
  of finite degree $n$.

  $\rmm$ consists of all extensions of the standard valuations on $K$ (which we
  know from Ostrowski's theorem). We can, after raising all the valuations in the
  product formula to some fixed power, assume they are normed. We have

  \[ \sum_{\pp|p}n(\pp) = n \]

  for all $p\in K$.
\end{thm}
